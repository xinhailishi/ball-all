var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(a,h){function n(t){try{r(s.next(t))}catch(e){h(e)}}function o(t){try{r(s["throw"](t))}catch(e){h(e)}}function r(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(n,o)}r((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,h&&(n=h[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(h,i[1])).done)return n;switch(h=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,h=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){r.label=i[1];break}if(6===i[0]&&r.label<n[1]){r.label=n[1],n=i;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(i);break}n[2]&&r.ops.pop(),r.trys.pop();continue}i=e.call(t,r)}catch(s){i=[6,s],h=0}finally{a=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,h,n,o,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},Ball=function(t){function e(e,i,s,a,h){void 0===e&&(e=30),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===h&&(h=.2);var n=t.call(this)||this;return n.banjing=30,n.ang=20,n.v=0,n.weight=1,n.f=.1,n.getScored=!1,n.f=h,n.banjing=e,n.graphics.beginFill(i,1),n.graphics.drawCircle(s,a,e),n.graphics.endFill(),n}return __extends(e,t),e.getRandomColor=function(){return 16711680+167772.15*Math.floor(100*Math.random())},e}(egret.Shape);__reflect(Ball.prototype,"Ball");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.textField.width=this.stage.stageWidth,this.textField.height=this.stage.stageHeight},e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.textColor=16777215,this.textField.size=80,this.textField.width=500,this.textField.height=300,this.textField.textAlign=egret.HorizontalAlign.CENTER,this.textField.verticalAlign=egret.VerticalAlign.MIDDLE},e.prototype.onProgress=function(t,e){this.textField.text="加载中..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e._randomPoint=new egret.Point,e.score=0,e.v1=20,e.v2=0,e.ang=0,e.ang2=0,e.c=.017453292,e._distance=new egret.Point,e._touchePoint=new egret.Point,e._isyaoed=!1,e._inArc=!1,e._moveEnd=!0,e._touchStatus=!1,e.shape1=new Ball,e.shape2=new Ball,e.shape3=new egret.Shape,e.line1=new egret.Shape,e.line2=new egret.Shape,e.line3=new egret.Shape,e.iszhudong=!0,e.balls=[],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.drawTip(),[4,platform.login()];case 2:return i.sent(),[4,platform.getUserInfo()];case 3:return t=i.sent(),e=this,[4,platform.getMyScore()];case 4:return e.score=i.sent(),console.log(t),[2]}})})},e.prototype.drawTip=function(){var t=new egret.TextField;t.text="          游戏规则\n\n\n1、控制黑球进洞变为红球\n2、控制红球撞击白球得1分\n3、红球再进洞视为淹死扣1分\n4、速度过快将反弹无法进洞\n\n\n      点击开始游戏",t.bold=!0,t.touchEnabled=!0,t.textColor=16777215,t.size=40,this.addChild(t),t.width=400,t.x=320-t.textWidth/2,t.y=400-t.textHeight/2,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.removeChild(t),this.drawBase()},this)},e.prototype.drawBase=function(){RES.getResByUrl("resource/assets/cartoon-font.fnt",this.onLoadFontComplete,this,RES.ResourceItem.TYPE_FONT),this.stage.frameRate=40;var t=new egret.Shape;this.addChild(t),t.graphics.beginFill(2263842,1),t.graphics.lineStyle(5,2263842),t.graphics.drawRect(0,0,this.stage.stageWidth+40,this.stage.stageHeight+50),t.graphics.endFill(),t.touchEnabled=!1,t.cacheAsBitmap=!0,this.setChildIndex(t,this.numChildren-1);var e=this.shape1=new Ball(30,0,0,0,.1);this.addChild(e),this.balls.push(e),e.x=this.stage.stageWidth/2-2*e.banjing,e.y=this.stage.stageHeight-2*e.banjing,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.setChildIndex(e,this.numChildren-1),e.cacheAsBitmap=!0;var i=this.shape2=new Ball(30,16777200,0,0,.4);this.addChild(i),this.balls.push(i),i.x=this.stage.stageWidth/2+i.banjing,i.y=this.stage.stageHeight-2*i.banjing,i.touchEnabled=!0,this.setChildIndex(i,this.numChildren-2),i.cacheAsBitmap=!0;var s=this.shape3;this.addChild(s),s.graphics.beginFill(5597999,1),s.graphics.lineStyle(5,16777215),s.graphics.drawCircle(0,0,50),s.graphics.endFill(),s.x=this.stage.stageWidth/2,s.y=100,s.touchEnabled=!1,this.setChildIndex(s,this.numChildren-3),s.cacheAsBitmap=!0;var a=this.line1;a.graphics.lineStyle(10,16711935),a.graphics.moveTo(0,0),a.graphics.lineTo(this.stage.stageWidth,0),a.graphics.endFill(),a.x=0,a.y=150,this.addChild(a),this.setChildIndex(a,this.numChildren-3),this.removeChild(this.line1),a.cacheAsBitmap=!0;var h=this.line2;h.graphics.lineStyle(10,16776960),h.graphics.moveTo(0,0),h.graphics.lineTo(this.stage.stageWidth,0),h.graphics.endFill(),h.x=0,h.y=this.stage.stageHeight-110,this.addChild(h),this.setChildIndex(h,this.numChildren-3),h.cacheAsBitmap=!0;var n=this.line3;n.graphics.lineStyle(5,16711935),n.graphics.moveTo(0,0),n.graphics.lineTo(50,0),n.graphics.endFill(),n.x=this.shape1.x,n.y=this.shape1.y,this.addChild(n),this.setChildIndex(n,this.numChildren-3),n.rotation=-90,this.removeChild(this.line3),this.addEventListener(egret.Event.ENTER_FRAME,this.commonTimeFunc,this)},e.prototype.getRandomPos=function(t){return{x:t+Math.floor((this.stage.stageWidth-2*t)*Math.random()),y:t+Math.floor((this.stage.stageHeight-2*t)*Math.random())}},e.prototype.commonTimeFunc=function(t){if(this.balls[0].v>0&&(Math.abs(this.shape1.x-this.shape3.x)<20&&Math.abs(this.shape1.y-this.shape3.y)<20&&!this._inArc&&(this.balls[0].v<15?(this._moveEnd=!0,this.shape1.x=this.shape3.x,this.shape1.y=this.shape3.y,this.balls[0].v=0,this._inArc=!0,this.shape1.graphics.clear(),this._isyaoed?(this.shape1.graphics.lineStyle(5,6908265),this.shape1.graphics.beginFill(6908265,1),this.shape1.touchEnabled=!1,this.score&&this.score--,this.updateBitmapTextContent(),this.updateBitmapTextContent1("-1"),this._sound5.play(this._sound5.length,1),egret.setTimeout(function(){this.resetGame()},this,2e3)):(this.shape1.graphics.lineStyle(5,16711680),this.shape1.graphics.beginFill(16711680,1),this._sound5.play(this._sound5.length,1)),this.shape1.graphics.drawCircle(0,0,30),this.shape1.graphics.endFill(),this._isyaoed=!this._isyaoed):this.balls[0].ang=this.balls[0].ang+180),(Math.abs(this.shape1.x-this.shape3.x)>20||Math.abs(this.shape1.y-this.shape3.y)>20)&&(this._inArc=!1)),this.balls[0].v>0){var e=(this.shape1.x-this.shape2.x)*(this.shape1.x-this.shape2.x)+(this.shape1.y-this.shape2.y)*(this.shape1.y-this.shape2.y)<=4900;e&&(this.balls[1].ang=this.balls[0].ang,this.balls[0].ang=this.balls[0].ang+180,0==this.balls[0].v?(this.balls[0].v=this.balls[1].v/2,this.iszhudong=!1):this.balls[1].v=2*this.balls[0].v,this.shape2.scaleX=.8,this.shape2.rotation=this.balls[1].ang,this._isyaoed&&this.iszhudong&&(this.score++,this.updateBitmapTextContent(),this.updateBitmapTextContent1("+1"),this.balls[0].getScored=!0,this._sound4.play(this._sound4.length,1)))}for(var i=0;i<this.balls.length;++i)this.balls[i].v>0&&(0==this.balls[i].ang&&(this.balls[i].ang=10),this.balls[i].y=this.balls[i].y+this.balls[i].v*Math.sin(this.balls[i].ang*this.c),this.balls[i].x=this.balls[i].x+this.balls[i].v*Math.cos(this.balls[i].ang*this.c),this.balls[i].y<this.balls[i].banjing&&(this.balls[i].y=this.balls[i].banjing,this.balls[i].ang=-this.balls[i].ang),this.balls[i].x<this.balls[i].banjing&&(this.balls[i].x=this.balls[i].banjing,this.balls[i].ang=180-this.balls[i].ang),this.balls[i].y>this.stage.stageHeight-this.balls[i].banjing&&(this.balls[i].y=this.stage.stageHeight-this.balls[i].banjing,this.balls[i].ang=-this.balls[i].ang),this.balls[i].x>this.stage.stageWidth-this.balls[i].banjing&&(this.balls[i].x=this.stage.stageWidth-this.balls[i].banjing,this.balls[i].ang=180-this.balls[i].ang),this.balls[i].v-=this.balls[i].f,this.balls[1].scaleX<1&&(this.balls[1].scaleX+=.1),this.balls[i].v<0&&(this.balls[i].v=0,this.balls[i].scaleX=1,0==i&&(this.balls[0].getScored?(this.resetGame(),this._moveEnd=!0,this.balls[0].getScored=!1):this.iszhudong&&this.getStageRandom())));this.line3.x=this.balls[0].x,this.line3.y=this.balls[0].y},e.prototype.mouseUp=function(t){console.log("Mouse Up."),this._touchStatus&&(this.iszhudong=!0,this.balls[0].v=10+Math.floor(10*(1-this.balls[0].scaleX)),this._moveEnd=!1,this.removeChild(this.line3),this._sound1.play(1,1)),this._touchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.resetGame=function(){this.shape1.graphics.clear(),this.shape1.graphics.beginFill(0,1),this.shape1.graphics.lineStyle(5,0),this.shape1.graphics.drawCircle(0,0,30),this.shape1.graphics.endFill(),this.shape1.touchEnabled=!0,this.shape1.x=this.stage.stageWidth/2-60,this.shape1.y=this.stage.stageHeight-60,this.shape2.x=this.stage.stageWidth/2+60,this.shape2.y=this.stage.stageHeight-60,this.line3.x=this.shape1.x,this.line3.y=this.shape1.y,this._isyaoed=!1,this._moveEnd=!0},e.prototype.radomShape2=function(){Math.abs(this._randomPoint.x-this.shape3.x)<80&&Math.abs(this._randomPoint.y-this.shape3.y)<80&&this.getStageRandom(),console.info("大海");var t=0;t=Math.atan2(this._randomPoint.y-this.shape2.y,this._randomPoint.x-this.shape2.x)/this.c,this.shape2.ang=t,this.shape2.v=30,this._moveEnd=!0},e.prototype.getStageRandom=function(){this._randomPoint.x=30+Math.floor((this.stage.stageWidth-60)*Math.random()),this._randomPoint.y=30+Math.floor((this.stage.stageHeight-60)*Math.random()),this.radomShape2()},e.prototype.timerFunc3=function(t){this._touchStatus?(this.shape1.scaleX-=.01,this.shape1.rotation=this.balls[0].ang,this.shape1.scaleX<.4&&(this.shape1.scaleX=.4)):(this.shape1.scaleX+=.05,this.shape1.rotation=this.balls[0].ang,this.shape1.scaleX>1&&(this.shape1.scaleX=1,this.timer3.stop()))},e.prototype.mouseDown=function(t){this._moveEnd&&(console.log("Mouse Down."),this._touchStatus=!0,this._touchePoint.x=t.stageX,this._touchePoint.y=t.stageY,this.balls[0].ang=this.getTouchAngle(this.balls[0]),this.line3.rotation=this.balls[0].ang,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this),this.addChild(this.line3))},e.prototype.mouseMove=function(t){if(this._touchStatus){this._touchePoint.x=t.stageX,this._touchePoint.y=t.stageY;var e=this.balls[0].ang=this.getTouchAngle(this.balls[0]);this.line3.rotation=e,console.info(e)}},e.prototype.getTouchAngle=function(t){var e=0;return e=Math.atan2(this._touchePoint.y-t.y,this._touchePoint.x-t.x)/this.c},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,s,a,h,n;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return o.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return o.sent(),e=this._sound1=new egret.Sound,this._sound1=RES.getRes("fashe_mp3"),i=this._sound2=new egret.Sound,this._sound2=RES.getRes("pengzhuang_mp3"),i.addEventListener(egret.Event.COMPLETE,function(t){this._sound2.play(this._sound2.length,1)},this),s=this._sound4=new egret.Sound,this._sound4=RES.getRes("win_mp3"),a=this._sound5=new egret.Sound,this._sound5=RES.getRes("jinquan_mp3"),h=this._sound3=new egret.Sound,h.load("resource/assets/background"+Math.floor(3*Math.random())+".mp3"),h.addEventListener(egret.Event.COMPLETE,function(t){this._sound3.play(this._sound3.length,99999999)},this),this.stage.removeChild(t),[3,4];case 3:return n=o.sent(),console.error(n),[3,4];case 4:return[2]}})})},e.prototype.onLoadFontComplete=function(t){this._bitmapText=new egret.BitmapText,this._bitmapText.font=t,this._bitmapText.x=10,this._bitmapText.y=10,this._bitmapText.scaleX=this._bitmapText.scaleY=2,this.addChild(this._bitmapText),this.updateBitmapTextContent(),this._bitmapText1=new egret.BitmapText,this._bitmapText1.font=t,this._bitmapText1.lineSpacing=10,this._bitmapText1.x=this.stage.stageWidth/2-70,this._bitmapText1.y=230,this._bitmapText1.scaleX=this._bitmapText1.scaleY=4,this.addChild(this._bitmapText1),this._bitmapText1.alpha=0,this.updateBitmapTextContent1(" ")},e.prototype.updateBitmapTextContent1=function(t){this._bitmapText1.text=t;var e=egret.Tween.get(this._bitmapText1);e.to({alpha:1},200),e.wait(2e3),e.to({alpha:0},200)},e.prototype.updateBitmapTextContent=function(){this._bitmapText.text=this.score.toString(),platform.setMyscore(this.score)},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var s=new egret.Shape;s.graphics.beginFill(0,.5),s.graphics.drawRect(0,0,e,172),s.graphics.endFill(),s.y=33,this.addChild(s);var a=this.createBitmapByName("egret_icon_png");this.addChild(a),a.x=26,a.y=33;var h=new egret.Shape;h.graphics.lineStyle(2,16777215),h.graphics.moveTo(0,0),h.graphics.lineTo(0,117),h.graphics.endFill(),h.x=172,h.y=61,this.addChild(h);var n=new egret.TextField;n.textColor=16777215,n.width=e-172,n.textAlign="center",n.text="Hello Egret",n.size=24,n.x=172,n.y=80,this.addChild(n);var o=new egret.TextField;this.addChild(o),o.alpha=0,o.width=e-172,o.textAlign=egret.HorizontalAlign.CENTER,o.size=24,o.textColor=16777215,o.x=172,o.y=135,this.textfield=o},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,s=t.map(function(t){return i.parse(t)}),a=this.textfield,h=-1,n=function(){h++,h>=s.length&&(h=0);var t=s[h];a.textFlow=t;var i=egret.Tween.get(a);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(n,e)};n()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.doOnShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getMyScore=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,3]})})},t.prototype.setMyscore=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);